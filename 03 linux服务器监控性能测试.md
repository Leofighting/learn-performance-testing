### 服务器性能测试范围

> 测试目的：发现服务器的性能瓶颈，配置的不同能够承载的最大任务数不同，能够承载的压力也不同

> 测试范围及性能指标
>
> - CPU
> - 内存
> - 磁盘
> - 网络
> - 版本

> 测试环境与生产环境配置不同的处理方法：通过多次压测来计算性能耗损
>
> - 性能损耗的计算方式：多次压测后的性能预估



### 进程与线程

> 进程：具有一定独立功能的程序，关于某个数据集合上的一次运行活动，是系统进行资源分配和调度的一个独立单位
>
> 线程：进程的一个实体，是CPU 调度和分派的基本单位，是比进程更小的能够独立运行的基本单位，线程基本上不拥有系统资源，只拥有一点在运行中必不可少的资源。一个线程可以创建和撤销另一个线程

> 区别：
>
> - 一个线程只能属于一个进程，而一个进程可以拥有多个线程
> - 线程是进程工作的最小单位
> - 一个进程会分配一个地址空间，进程与进程间不共享地址空间，即不共享内存
> - 同一个进程下的不同的多个线程，共享父进程的地址空间
> - 线程在执行过程中，需要协作同步。不同进程的线程间需要利用消息通信的办法实现同步
> - 线程作为调度和分配的基本单位，进程作为拥有资源的基本单位

> 进程的优点
>
> - 每个进程相互独立，不影响主程序的稳定性，子进程崩溃不影响其他进程
> - 通过增加 CPU ，就可以扩充性能
> - 可以尽量减少线程加锁与解锁的影响，极大地提高了性能
>
> 进程的缺点：
>
> - 逻辑控制复杂，需要和主程序交互
> - 多进程调度开销大

> 线程的优点
>
> - 程序逻辑和控制方式简单
> - 所有线程可以直接共享内存和变量
> - 线程方式消耗的总资源比进程方式少
>
> 线程的缺点
>
> - 每个线程与主程序共用地址空间，最大内存地址受限
> - 线程之间的同步和加锁不易控制
> - 一个线程的崩溃可能影响到整个程序的稳定性



### Linux 监控相关的命令

> `top`：能够实时监控系统的运行状态，并且可以按照 CPU 及内存等进行排序
>
> - `-p`：监控指定进程；当监控多个进程时，进程 id 以逗号分隔
> - 任务区命令
>   - `M`：按内存使用率排序
>   - `P`：按 CPU 使用率排序
>   - `z`：彩色 / 黑白显示

> `vmstat`：可以监控操作系统的进程状态、内存、虚拟内存、磁盘IO、CPU 的信息
>
> - -S：使用指定单位显示

> `free`：能够监控系统的内存使用状态

> `mpstat`：可以查看多核心 CPU 中每个计算核心的统计数据
>
> - `-P{|ALL}`：表示监控那个 CPU，CPU 在 [0, CPU 个数 - 1] 中取值
> - `internal`：相邻的两次采用的间隔时间

> `netstat`：用于显示本机网络链接、运行端口、路由表等信息
>
> - `-n`：拒绝现实别名，能显示数字的全部转化为数字
> - `-l`：仅列出有在 监听 的服务状态
> - `-p`：显示建立相关链接的程序名
> - `-t`：显示 `tcp` 相关选项
> - `-u`：仅显示 `udp` 相关的选项
> - `-i`：显示自动匹配接口的信息
> - `-c`：每隔一个固定时间，执行该 `netstat` 命令

> `iostat`：对系统磁盘 IO 操作进行监控，它的输出主要显示磁盘的读写操作的统计信息，同时给出 CPU 的使用情况
>
> - `-x`：输出指定要统计的磁盘设备名称，默认为所有磁盘设备

> `sar`：目前 Linux 上最为全面的系统性能分析工具之一，可以从多方面对系统的活动进行报告
>
> - 性能监控范围：文件的读写情况，系统调用的使用情况，磁盘IO ，CPU 效率，内存使用状况，进程活动及 `IPC` 有关的活动等
> - `-A`：所有报告的总和
> - `-u`：CPU 的使用率
> - `-v`：进程、节点、文件和锁表的状态
> - `-r`：显示系统内存的使用情况
> - `-B`：内存分页的情况
> - `-b`：缓冲区使用的情况

> `strace`：是一个及诊断、调试、统计于一体的工具，可以使用 `strace` 对应用的系统调用和信号传递的跟踪结果来对应用进行分析，以达到解决问题或者是了解应用工作过程的目的
>
> - `-p`：跟踪指定的进程
> - `-f`：跟踪由 fork 子进程系统调用
> - `-c`：统计每一系统调用的所执行的时间，次数和出错的次数等
> - `-t`：在输出中的每一行前加上时间信息。 `-tt`：时间精确到微秒级别
> - `-e expr`：输出过滤器，通过表达式，可以过滤掉不需要的输出
> - `-o filename`：默认 `strace` 将结果输出到 `stdout` 。通过 `-o` 可以将输出写入到 filename 文件中

 

### Linux 监控工具

> `nmon`：一种在 `Linux` 操作系统上广泛使用的监控与分析工具，能在系统运行过程中实时地捕捉系统资源的使用情况，并且能输出结果到文件中，然后通过 `nmon_analyzer` 工具产生数据文件与图形化结果。



### Linux定时任务

> `crontab`

